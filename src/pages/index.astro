---
import { getCollection } from "astro:content";

import { RecentComment } from "@myriaddreamin/tylant-comment";
import { ArchiveList } from "@myriaddreamin/tylant-pdf-archive";
import { TagList } from "@myriaddreamin/tylant";
import { renderComment } from "@myriaddreamin/tylant";

import BaseHead from "$components/BaseHead.astro";
import Header from "$components/Header.astro";
import Footer from "$components/Footer.astro";
import FormattedDate from "$components/FormattedDate.astro";
import TagListPublications from "$components/TagListPublications.astro";

import {
kSiteTitle,
kSiteIndexTitle,
kSiteDescription,
kCommentList,
kUrlBase,
kBaiduVeriCode,
kEnableComment,
kEnableArchive,
kJobTitle,
social,
} from "$consts";
// @ts-ignore
import AboutContent from "../../content/other/about.typ?html&body";

import "$styles/IndexPostList.css";

const pubs = (await getCollection("pub")).sort(
(a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);
const blogs = (await getCollection("blog")).sort(
(a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const recent5Pubs = pubs.slice(0, 5);
const recent5Blogs = blogs.slice(0, 5);
const thereAreBlogs = recent5Blogs.length > 0;

import { Image } from 'astro:assets';
import ConopsPicture from '../assets/conops.png';
import Sidebar from "$components/Sidebar.astro";
// import ProfilePortrait from '../assets/me3.jpg';
// import SocialIcons from '../components/SocialIcons.astro'
// import Navbar from '../components/Navbar.astro';
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead title={kSiteTitle} description={kSiteDescription} />
        <style>
            .comments a {
                display: inline-block;
            }
            @media (max-width: 600px) {
                .posts .heading {
                    display: flex;
                    flex-direction: column;
                }
            }
            .comment-item {
                background-color: var(--main-bg-color);
            }
            .monthly li {
                font-style: italic;
            }
        </style>
    </head>
<body>
    <Sidebar />

    <div class="w3-main" style="margin-left:300px">

    <Header />
    <main>
        <section aria-label="Prelude">
            <h1 set:html={kSiteIndexTitle} />
            <!-- <AboutContent /> -->
            <Image
                class='mask mask-circle size-44'
                src={ConopsPicture}
                alt="Conops"
                    >
        </section>
            <section aria-label="About">
              <AboutContent />
            </section>
            <section aria-label="Recent Publications">
                <h2>Recent Publications</h2>
                <ul class="accent block-list posts">
                           {
                           recent5Pubs.map((post) => (
                           <li>
                               <a class="heading" href={`${kUrlBase}/publications/${post.id}/`}>
                                   <h2>
                                       <span class="title">{post.data.title}</span>
                                   </h2>
                                   <span class="date">
                                       <FormattedDate date={post.data.date} />
                                   </span>
                               </a>
                               {post.data.author}</br>
                               <i>{post.data.venue}</i>
                                {(post.data.doi || post.data.file) && </br>}
                                {post.data.doi && <a href={`https://doi.org/${post.data.doi}`}>DOI</a>}
                                {post.data.doi && post.data.file && <span> | </span>}
                                {post.data.file && <a href={post.data.file}>File</a>}
                               {post.data.tags && <TagListPublications tags={post.data.tags} />}
                               <!-- {post.data.description || ""} -->
                           </li>
                           ))
                           }
                </ul>
            </section>
            { thereAreBlogs && (
            <section aria-label="Recent Blogs">
                <h2>Recent Blogs</h2>
                <ul class="accent block-list posts">
                           {
                           recent5Blogs.map((post) => (
                           <li>
                               <a class="heading" href={`${kUrlBase}/blog/${post.id}/`}>
                                   <h2>
                                       <span class="title">{post.data.title}</span>
                                   </h2>
                                   <span class="date">
                                       <FormattedDate date={post.data.date} />
                                   </span>
                               </a>
                               {post.data.tags && <TagList tags={post.data.tags} />}
                               <!-- {post.data.description || ""} -->
                           </li>
                           ))
                           }
                </ul>
            </section>
            )}
            {
            kEnableComment && (
            <RecentComment
            kCommentList={kCommentList}
            renderComment={renderComment}
            >
            <fragment slot="articleRef">
            {(id: string) => (
            <a class="heading" href={`${kUrlBase}/article/${id}`}>
                {posts.find((post) => post.id === id)?.data.title || ""}
            </a>
            )}
            </fragment>
            </RecentComment>
            )
            }

            {kEnableArchive && <ArchiveList pdfArchives={pdfArchives} />}
        </main>
        <Footer />
        </div>
    </body>
</html>
